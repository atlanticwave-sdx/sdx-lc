# Swagger generated server

[![Test](https://github.com/atlanticwave-sdx/sdx-lc/actions/workflows/test.yml/badge.svg)](https://github.com/atlanticwave-sdx/sdx-lc/actions/workflows/test.yml)

[![Coverage Status](https://coveralls.io/repos/github/atlanticwave-sdx/sdx-lc/badge.svg)](https://coveralls.io/github/atlanticwave-sdx/sdx-lc)

## Overview
This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, you can easily generate a server stub.  This
is an example of building a swagger-enabled Flask server.

This example uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Requirements

Python 3.9.6+.

## Prerequisite: run the RabbitMQ server

The communication between SDX controller and Local controller rely on RabbitMQ. RabbitMQ can either run on the SDX controller, or run on a separate node. The easiest way to run RabbitMQ is using docker:

```
sudo docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:latest
```

Then in `env` and `docker-compose.yml` files, change `MQ_HOST` host to the corresponding IP address or hostname of the RabbitMQ server

You also will need a MongoDB server:

```console
$ docker run -it --rm --name mongo \
    -p 27017:27017 \
    -e MONGO_INITDB_ROOT_USERNAME=guest \
    -e MONGO_INITDB_ROOT_PASSWORD=guest \
    mongo:3.7
```

## Run with Python

It would be helpful to use a virtual environment:

```console
$ python3 -m venv venv
$ source venv/bin/activate
```

To run the swagger server, please execute the following from the root directory:

```console
$ pip3 install -r requirements.txt
$ python3 -m swagger_server
```

and open your browser to here:

```
http://localhost:8080/SDX-LC/1.0.0/ui/
```

Your Swagger definition lives here:

```
http://localhost:8080/SDX-LC/1.0.0/swagger.json
```

To launch the integration tests, use tox:

```console
$ pip install tox
$ tox
```

## Running with Docker

To run the server on a Docker container, please execute the following from the root directory:

```bash
# building the image
docker build -t swagger_server .

# starting up a container
docker run -p 8080:8080 swagger_server

# or start with docker-compose
docker-compose up
```

## Communication between SDX Controller and Local Controller

The SDX controller and local controller communicate using RabbitMQ. All the topology and connectivity related messages are sent with RPC, with receiver confirmation. The monitoring related messages are sent without receiver confirmation.

Below are two sample scenarios for RabbitMQ implementation:

SDX controller breaks down the topology and sends connectivity information to local controllers:
![SDX controller to local controller](https://user-images.githubusercontent.com/29924060/139590360-d6c9aaef-e9ba-4c32-a8f9-7a0644b4b35f.jpg)

Local controller sends domain information to SDX controller:
![Local controller to SDX controller](https://user-images.githubusercontent.com/29924060/139590365-361b4f46-984c-4ab6-8d47-83c9c362910b.jpg)
